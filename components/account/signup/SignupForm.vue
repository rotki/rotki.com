<template>
  <page>
    <template #title> Create a rotki premium Account </template>

    <div :class="$style.row">
      <div :class="$style.column">
        <div :class="$style.hint">
          <span :class="$style.important">Important</span> Note: Creating an
          account in rotki.com is only needed to purchase a
          <external-link url="/products" text="premium subscription" same-tab />
          Rotki is a local application and the account you create when you use
          it is stored on your computer. This is not the same account as premium
          and credentials for one account don't work for the other. To use Rotki
          simply
          <external-link
            url="https://github.com/rotki/rotki/releases/latest"
            text="download"
            noreferrer
          />
          and run it. Proceed only if you intend to purchase premium and unlock
          the premium features of the application.
        </div>

        <div :class="$style.section">Account</div>

        <div :class="$style.inputs">
          <input-field
            id="username"
            v-model="username"
            label="Username"
            hint="Required: Provide a unique username for your new account."
          />
          <input-field
            id="email"
            v-model="email"
            type="email"
            label="Email"
            hint="Required. Provide a valid email address."
          />
          <input-field
            id="github"
            v-model="github"
            label="Github Username"
            hint="Optional. Provide Github username for in-Github support."
          />
          <input-field
            id="password"
            v-model="password"
            type="password"
            label="Password"
          >
            <ul :class="$style.list">
              <li>
                Your password can't be too similar to your other personal
                information.
              </li>
              <li>Your password must contain at least 8 characters.</li>
              <li>Your password can't be a commonly used password.</li>

              <li>Your password can't be entirely numeric.</li>
            </ul>
          </input-field>

          <input-field
            id="password-confirmation"
            v-model="passwordConfirmation"
            type="password"
            label="Password Confirmation"
            hint="Enter the same password as before, for verification."
          />
        </div>

        <div :class="$style.section">Customer Information</div>

        <div :class="$style.inputs">
          <input-field
            id="first-name"
            v-model="firstName"
            label="First Name"
            hint="Required. Will only be used for invoice of payments."
          />
          <input-field
            id="last-name"
            v-model="lastName"
            label="Last Name"
            hint="Required. Will only be used for invoice of payments."
          />
          <input-field
            id="company-name"
            v-model="companyName"
            label="Company Name"
            hint="Optional. If you want to be invoiced as a company the given company name will be added to the invoice."
          />
          <input-field
            id="vat-id"
            v-model="vatId"
            label="VAT ID"
            hint="Optional. If you want to be invoiced as a company, the provided VAT ID will be added to the invoice."
          />
        </div>

        <div :class="$style.section">Address</div>

        <div :class="$style.inputs">
          <input-field
            id="address-1"
            v-model="address1"
            label="Address line 1"
            hint="Required. Will only be used for invoice of payments."
          />
          <input-field
            id="address-2"
            v-model="address2"
            label="Address line 2"
            hint="Optional. Additional data for the address."
          />
          <input-field
            id="city"
            v-model="city"
            label="City"
            hint="Required. Will only be used for invoice of payments."
          />
          <input-field
            id="postal"
            v-model="postal"
            label="Postal code"
            hint="Required. Will only be used for invoice of payments."
          />
          <input-field
            id="country"
            v-model="country"
            :items="countries"
            type="select"
            label="Country"
            placeholder="Select country"
            hint="Required. Will only be used for invoice of payments."
          />
        </div>

        <recaptcha
          :class="$style.recaptcha"
          @success="onSuccess"
          @error="onError"
          @expired="onExpired"
        />

        <label :class="$style.termsCheck">
          <input
            :value="termsAccepted"
            type="checkbox"
            :class="$style.checkbox"
            @click="termsAccepted = !termsAccepted"
          />
          <span :class="$style.terms">
            I have read and agreed to the
            <external-link text="Terms of Service" url="/tos" />
            and the
            <external-link text="Privacy Policy" url="/privacy-policy" />
          </span>
        </label>

        <action-button
          :disabled="!valid"
          primary
          text="Create Account"
          :class="$style.button"
        />
      </div>
    </div>
  </page>
</template>

<script lang="ts">
import { computed, defineComponent, ref } from '@nuxtjs/composition-api'
import { setupCSRF } from '~/composables/csrf-token'
import { loadCountries } from '~/composables/countries'
import { setupRecaptcha } from '~/composables/repatcha'

export default defineComponent({
  name: 'SignupForm',
  setup() {
    const termsAccepted = ref(false)
    const valid = computed(
      (ctx) =>
        ctx.username !== '' &&
        ctx.password !== '' &&
        ctx.passwordConfirmation !== '' &&
        ctx.firstName !== '' &&
        ctx.lastName !== '' &&
        ctx.address1 !== '' &&
        ctx.city !== '' &&
        ctx.postal !== '' &&
        ctx.country !== '' &&
        ctx.termsAccepted &&
        ctx.recaptchaPassed
    )
    setupCSRF()
    return {
      ...loadCountries(),
      ...setupRecaptcha(),
      valid,
      termsAccepted,
    }
  },
  data() {
    return {
      username: '',
      password: '',
      passwordConfirmation: '',
      email: '',
      github: '',
      confirmation: '',
      firstName: '',
      lastName: '',
      companyName: '',
      vatId: '',
      address1: '',
      address2: '',
      city: '',
      postal: '',
      country: '',
    }
  },
})
</script>

<style module lang="scss">
@import '~assets/css/media';
@import '~assets/css/main';

.row {
  @apply flex flex-row mx-auto;
}

.column {
  @apply flex flex-col;
}

.hint {
  @apply font-sans;

  margin-top: 48px;
  align-items: center;
  text-align: justify;
  color: #808080;

  div {
    margin-left: auto;
    margin-right: auto;
    max-width: 500px;
  }

  @include text-size(14px, 21px);
  @include for-size(phone-only) {
    bottom: $mobile-margin / 2;
    padding: $mobile-margin / 2;
  }
}

.section {
  @apply font-serif;

  margin-top: 48px;

  @include text-size(24px, 32px);
}

.inputs {
  margin-top: 12px;
  > * {
    margin-top: 24px;
  }
}

.checkbox {
  @apply h-5 w-5 text-primary;
}

.termsCheck {
  @apply inline-flex items-center mt-8;
}

.terms {
  @apply ml-2 text-primary2;
}

.list {
  @apply text-xs;

  list-style-type: circle;
  padding-left: $mobile-margin * 2;
  color: #808080;
}

.button {
  margin-top: 48px;
}

.recaptcha {
  margin-top: 48px;
}
</style>
